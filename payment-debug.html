<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1d4ed8">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Payment Debug - ThinkRight</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            color: #00ffff;
            border-bottom: 2px solid #00ffff;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #2d2d2d;
            border-left: 4px solid #00ff00;
        }
        .section h2 {
            margin-top: 0;
            color: #ffff00;
        }
        .url-params {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            word-break: break-all;
        }
        .status-good { color: #00ff00; }
        .status-warn { color: #ffff00; }
        .status-bad { color: #ff0000; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
            font-family: monospace;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Payment Callback Debug Tool</h1>
        
        <div class="section">
            <h2>üìç Current URL</h2>
            <div class="url-params" id="currentUrl"></div>
        </div>

        <div class="section">
            <h2>üîç Query Parameters</h2>
            <div id="queryParams"></div>
        </div>

        <div class="section">
            <h2>#Ô∏è‚É£ Hash Parameters</h2>
            <div id="hashParams"></div>
        </div>

        <div class="section">
            <h2>üìä Analysis</h2>
            <div id="analysis"></div>
        </div>

        <div class="section">
            <h2>üß™ Test Actions</h2>
            <button onclick="testSuccessfulPayment()">Simulate Successful Payment</button>
            <button onclick="testFailedPayment()">Simulate Failed Payment</button>
            <button onclick="goToPaymentCallback()">Go to payment-callback.html</button>
        </div>

        <div class="section">
            <h2>üìù Instructions</h2>
            <p>1. Complete a payment on Flutterwave</p>
            <p>2. When redirected back, Flutterwave should add these parameters:</p>
            <p><span class="status-good">‚úì</span> <code>status=successful|failed|cancelled</code></p>
            <p><span class="status-good">‚úì</span> <code>tx_ref=your_transaction_ref</code></p>
            <p>3. Check this page to see what parameters are being received</p>
        </div>
    </div>

    <script>
        console.log('üêõ Payment Debug Tool Loaded');

        function displayDebug() {
            // Display current URL
            document.getElementById('currentUrl').textContent = window.location.href;

            // Parse query parameters
            const params = new URLSearchParams(window.location.search);
            const queryParamsDiv = document.getElementById('queryParams');
            
            if (window.location.search) {
                let html = '<div class="status-good">‚úì Query string found:</div>';
                for (const [key, value] of params) {
                    html += `<div class="url-params"><strong>${key}:</strong> ${value}</div>`;
                }
                queryParamsDiv.innerHTML = html;
            } else {
                queryParamsDiv.innerHTML = '<div class="status-warn">‚ö† No query parameters in URL</div>';
            }

            // Parse hash parameters
            const hashParamsDiv = document.getElementById('hashParams');
            if (window.location.hash) {
                const hashParams = new URLSearchParams(window.location.hash.substring(1));
                let html = '<div class="status-warn">‚ö† Hash parameters found (unusual for Flutterwave):</div>';
                for (const [key, value] of hashParams) {
                    html += `<div class="url-params"><strong>${key}:</strong> ${value}</div>`;
                }
                hashParamsDiv.innerHTML = html;
            } else {
                hashParamsDiv.innerHTML = '<div class="status-good">‚úì No hash parameters (normal)</div>';
            }

            // Analysis
            const analysisDiv = document.getElementById('analysis');
            const status = params.get('status');
            const txRef = params.get('tx_ref');
            
            let analysis = '';
            
            if (!status) {
                analysis += '<div class="status-bad">‚ùå CRITICAL: No status parameter found</div>';
                analysis += '<div>This means Flutterwave is not redirecting with the status parameter.</div>';
                analysis += '<div style="margin-top: 10px;"><strong>Possible causes:</strong>';
                analysis += '<ul>';
                analysis += '<li>Flutterwave redirect_url configuration is wrong</li>';
                analysis += '<li>Flutterwave is not configured to pass parameters</li>';
                analysis += '<li>Redirect URL path is incorrect</li>';
                analysis += '</ul></div>';
            } else {
                analysis += `<div class="status-good">‚úì Status parameter received: <strong>${status}</strong></div>`;
            }
            
            if (!txRef) {
                analysis += '<div class="status-warn">‚ö† No tx_ref parameter found</div>';
            } else {
                analysis += `<div class="status-good">‚úì Transaction reference received: <strong>${txRef}</strong></div>`;
            }
            
            if (status && txRef) {
                analysis += '<div class="status-good" style="margin-top: 10px;">‚úì Both parameters received correctly!</div>';
                analysis += '<div>The payment-callback.html should process this successfully.</div>';
            }
            
            analysisDiv.innerHTML = analysis;
        }

        function testSuccessfulPayment() {
            window.location.href = window.location.pathname + '?status=successful&tx_ref=thinkright_test_monthly_' + Date.now();
        }

        function testFailedPayment() {
            window.location.href = window.location.pathname + '?status=failed&tx_ref=thinkright_test_monthly_' + Date.now();
        }

        function goToPaymentCallback() {
            window.location.href = '/payment-callback.html?status=test&tx_ref=test';
        }

        displayDebug();
    </script>
    <script defer src="js/pwa-register.js"></script>
</body>
</html>



